var FTFeedParams=function(){this.segmentId,this.feedEndpoint,this.defaultFeedEndpoint,this.productId,this.ftCustomProductIdNodeName,this.ftCustomProductIndex=0,this.stringTrackerEventName,this.customMacros,this.customMacrosFlashVars,this.sendSegments},FTFeed=function(n,t){function d(t,s){var e={withCredentials:!!(l.sendSegments||-1<t.search(/ftcreds=(1|true)/i)),complete:function(t){!1!==f[s]&&clearTimeout(f[s]);let e=!1,n=t.responseText;try{n=JSON.parse(n)}catch(t){console.warn("Could not parse response text ... ",t),e=!0}return l.feedEndpoint!==s||m[s]||200===t.status&&!e&&!n.error?l.defaultFeedEndpoint!==s||m[s]||200===t.status&&!e&&!n.error?(e=n,t=[],Array.isArray(e)?t=e:t.push(e),l.ftCustomProductIdNodeName&&l.ftCustomProductIndex<t.length&&((e=t[l.ftCustomProductIndex][l.ftCustomProductIdNodeName])?i(e):i("default")),void u(t,r)):a("Feed error. Possible 4xx, 5xx, parse error or error field. Run backup logic!",r):l.defaultFeedEndpoint!==l.feedEndpoint&&""!==l.defaultFeedEndpoint?(r=o(l.productId,l.defaultFeedEndpoint),d(r,l.defaultFeedEndpoint)):a("Feed error. Possible 4xx, 5xx, parse error or error field. Run backup logic!",r)}};f[s]=setTimeout(function(){if(m[s]=!0,l.feedEndpoint===s&&l.feedEndpoint!==l.defaultFeedEndpoint&&""!==l.defaultFeedEndpoint)return r=o(l.productId,l.defaultFeedEndpoint),d(r,l.defaultFeedEndpoint);a("Feed response timeout error. Exceeded 3 seconds. Run backup logic.",r)},3e3),n.ajax(t,e)}function o(t,e){var n,s=this.myFT.get("serveDom")||this.myFT.get("ftServeDom")||"https://cdn.flashtalking.com",d={"[%PROTOCOL%]":-1<s.indexOf("https://")?"https://":"http://","[%PRODUCT_ID%]":t,"[%SERVE_DOM%]":s,"[%CACHEBUSTER%]":Math.floor(9e9*Math.random()),"[%CACHE_BUSTER%]":Math.floor(9e9*Math.random()),"[%RANDOM%]":Math.floor(9e9*Math.random()),"[%ftLat%]":this.myFT.get("ftLat")||"null","[%LAT%]":this.myFT.get("ftLat")||"null","[%ftLong%]":this.myFT.get("ftLong")||this.myFT.get("ftLng")||"null","[%LNG%]":this.myFT.get("ftLong")||this.myFT.get("ftLng")||"null","[%ftDMA%]":this.myFT.get("ftDMA")||"null","[%DMA%]":this.myFT.get("ftDMA")||"null","[%ftPostal%]":this.myFT.get("ftPostal")||"null","[%POSTAL%]":this.myFT.get("ftPostal")||"null","[%CITY%]":this.myFT.get("ftGeoCity")||"null","[%STATE%]":this.myFT.get("ftGeoState")||"null","[%COUNTRY%]":this.myFT.get("ftGeoCountry")||"null","[%GUID%]":this.myFT.get("guid")||this.myFT.get("ftGUID")||"null","[%CI_ID%]":this.myFT.get("cID")||"null","[%CRM_ID%]":this.myFT.get("cID")||"null","[%CM_ID%]":this.myFT.get("campaignID")||"null","[%CAM_ID%]":this.myFT.get("campaignID")||"null","[%CREATIVE_ID%]":this.myFT.get("creativeID")||"null","[%PLACEMENT_ID%]":this.myFT.get("pID")||this.myFT.get("ftPlacementID")||"null","[%IMPRESSION_ID%]":this.myFT.get("impressionID")||"null","[%IMPRESSIONID%]":this.myFT.get("impressionID")||"null","[%KEYWORD%]":this.myFT.get("ftKeyword")||"null","[%TIMESTAMP%]":this.myFT.get("ftTimestamp")||"null","[%FT_CUSTOM%]":this.myFT.get("ftCustom")||"null","[%CUSTOM%]":this.myFT.get("ftCustom")||"null","[%ORIGIN%]":window.location.host,"[%CONFID%]":this.myFT.get("confID")||this.myFT.get("confId")||"null","[%MARKET_ID%]":this.myFT.get("ftDMA")||"null","[%METRO_ID%]":this.myFT.get("ftDMA")||"null"};if(l.customMacros){let e=l.customMacros.split(/[\s,]+/),n=[];l.customMacrosFlashVars&&(n=l.customMacrosFlashVars.split(/[\s,]+/));for(let t=0;t<e.length;t++)e[t]&&(d[e[t]]=this.myFT.get(n[t])||"null")}for(n in d)-1<e.indexOf(n)&&(e=e.replace(n,d[n]));return-1<e.lastIndexOf("?")?e+="&callback=[%CALLBACK%]":e+="?callback=[%CALLBACK%]",e}function i(t){for(var e in t=encodeURIComponent(t),l.stringTrackerEventName&&this.myFT.tracker(l.stringTrackerEventName,null,t),this.myFT.get("clicks")){var n=this.myFT.get("clicks"),s=e,e=this.myFT.get("clicks")[e],d=t,o=/(ft_custom=.*?)(&|$)/i,e=o.test(e)?e.replace(o,"$1__"+d+"$2"):e.replace(/((http(s|):\/\/servedby.flashtalking.com.+?)(&url=))/,"$2&ft_custom="+d+"&url=");n[s]=e}}this.myFT=n;let l=function(t){return(t=t||new FTFeedParams).segmentId=t.segmentId||this.myFT.instantAds.segmentId||"",t.feedEndpoint=t.feedEndpoint||this.myFT.instantAds.feedEndpoint,t.defaultFeedEndpoint=t.defaultFeedEndpoint||this.myFT.instantAds.defaultFeedEndpoint,t.productId=t.productId||this.myFT.get("ftSku")||this.myFT.instantAds.productId||"null",t}(t),r,u,a,m={},f={};this.getFeed=function(t,e){u=t,a=e,"false"!==l.segmentId.toLowerCase()&&""!==l.segmentId&&-1<this.myFT.get("ftSegment").indexOf(l.segmentId)&&(l.productId=function(t){return null!==(t=new RegExp("(?:^|,)"+t+"(\\w+?)(,|$)").exec(this.myFT.get("ftSegment")))?t[1]:""}(l.segmentId)),"null"===l.productId&&-1<l.feedEndpoint.indexOf("[%PRODUCT_ID%]")&&(l.feedEndpoint=l.defaultFeedEndpoint),r=o(l.productId,l.feedEndpoint),d(r,l.feedEndpoint)}};